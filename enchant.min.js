<<<<<<< HEAD
/*
enchant.js v0.4.5
Copyright (c) Ubiquitous Entertainment Inc.
Dual licensed under the MIT or GPL Version 3 licenses
http://www.opensource.org/licenses/mit-license.php
http://www.gnu.org/licenses/gpl-3.0.html
*/
"function"!=typeof Object.defineProperty&&(Object.defineProperty=function(g,k,f){"value"in f&&(g[k]=f.value);"get"in f&&g.__defineGetter__(k,f.get);"set"in f&&g.__defineSetter__(k,f.set);return g});"function"!=typeof Object.defineProperties&&(Object.defineProperties=function(g,k){for(var f in k)k.hasOwnProperty(f)&&Object.defineProperty(g,f,k[f]);return g});
"function"!=typeof Object.create&&(Object.create=function(g,k){function f(){}f.prototype=g;var m=new f;k!=null&&Object.defineProperties(m,k);return m});"function"!=typeof Object.getPrototypeOf&&(Object.getPrototypeOf=function(g){return g.__proto__});
"function"!==typeof Function.prototype.bind&&(Function.prototype.bind=function(g){var k=this,f=Array.prototype.slice.call(arguments,1),m=function(){},p=function(){var o=f.concat(Array.prototype.slice.call(arguments));return k.apply(this instanceof m?this:g||window,o)};m.prototype=k.prototype;p.prototype=new m;return p});
var enchant=function(g){if(g!=null){g instanceof Array||(g=Array.prototype.slice.call(arguments));g=g.filter(function(g){return""+g})}(function f(m,p){var o=[],n;for(n in m)if(m.hasOwnProperty(n))if(typeof m[n]=="function")window[n]=m[n];else if(typeof m[n]=="object"&&Object.getPrototypeOf(m[n])==Object.prototype)if(g==null)o.push(n);else{e=g.indexOf(p+n);if(e!=-1){o.push(n);g.splice(e,1)}}var e=0;for(n=o.length;e<n;e++)f(m[o[e]],p+o[e]+".")})(enchant,"");if(g!=null&&g.length)throw Error("Cannot load module: "+
g.join(", "));};
(function(){function g(a){var b=a.match(/\.\w+[#\w]+$/);return b&&b.length>0?b[0].split("#")[0].slice(1).toLowerCase():a.indexOf("data:")===0?a.split(/[\/;]/)[1].toLowerCase():null}var k,f=navigator.userAgent;k=f.indexOf("Opera")!=-1?"O":f.indexOf("MSIE")!=-1?"ms":f.indexOf("WebKit")!=-1?"webkit":navigator.product=="Gecko"?"Moz":"";var m,f=document.createElement("div");f.setAttribute("ontouchstart","return");m=typeof f.ontouchstart=="function";var p;if(navigator.userAgent.indexOf("iPhone")!=-1&&window.devicePixelRatio==
2){f=document.querySelector('meta[name="viewport"]');if(f==null){f=document.createElement("meta");document.head.appendChild(f)}f.setAttribute("content","width=640px");p=true}else p=false;var o;var f=navigator.userAgent,n=navigator.vendor||"";o=location.href.indexOf("http")==0&&f.indexOf("Mobile")==-1&&n.indexOf("Apple")!=-1?true:false;var e;enchant.Class=function(a,b){return enchant.Class.create(a,b)};enchant.Class.create=function(a,b){if(arguments.length==0)return enchant.Class.create(Object,b);
if(arguments.length==1&&typeof arguments[0]!="function")return enchant.Class.create(Object,arguments[0]);for(var c in b)if(b.hasOwnProperty(c))if(typeof b[c]=="object"&&Object.getPrototypeOf(b[c])==Object.prototype){if(!("enumerable"in b[c]))b[c].enumerable=true}else b[c]={value:b[c],enumerable:true,writable:true};var d=function(){if(this instanceof d)d.prototype.initialize.apply(this,arguments);else return new d};d.prototype=Object.create(a.prototype,b);d.prototype.constructor=d;if(d.prototype.initialize==
null)d.prototype.initialize=function(){a.apply(this,arguments)};return d};enchant.Event=enchant.Class.create({initialize:function(a){this.type=a;this.target=null;this.localY=this.localX=this.y=this.x=0},_initPosition:function(a,b){this.x=this.localX=(a-e._pageX)/e.scale;this.y=this.localY=(b-e._pageY)/e.scale}});enchant.Event.LOAD="load";enchant.Event.PROGRESS="progress";enchant.Event.ENTER_FRAME="enterframe";enchant.Event.EXIT_FRAME="exitframe";enchant.Event.ENTER="enter";enchant.Event.EXIT="exit";
enchant.Event.ADDED="added";enchant.Event.ADDED_TO_SCENE="addedtoscene";enchant.Event.REMOVED="removed";enchant.Event.REMOVED_FROM_SCENE="removedfromscene";enchant.Event.TOUCH_START="touchstart";enchant.Event.TOUCH_MOVE="touchmove";enchant.Event.TOUCH_END="touchend";enchant.Event.RENDER="render";enchant.Event.INPUT_START="inputstart";enchant.Event.INPUT_CHANGE="inputchange";enchant.Event.INPUT_END="inputend";enchant.Event.LEFT_BUTTON_DOWN="leftbuttondown";enchant.Event.LEFT_BUTTON_UP="leftbuttonup";
enchant.Event.RIGHT_BUTTON_DOWN="rightbuttondown";enchant.Event.RIGHT_BUTTON_UP="rightbuttonup";enchant.Event.UP_BUTTON_DOWN="upbuttondown";enchant.Event.UP_BUTTON_UP="upbuttonup";enchant.Event.DOWN_BUTTON_DOWN="downbuttondown";enchant.Event.DOWN_BUTTON_UP="downbuttonup";enchant.Event.A_BUTTON_DOWN="abuttondown";enchant.Event.A_BUTTON_UP="abuttonup";enchant.Event.B_BUTTON_DOWN="bbuttondown";enchant.Event.B_BUTTON_UP="bbuttonup";enchant.EventTarget=enchant.Class.create({initialize:function(){this._listeners=
{}},addEventListener:function(a,b){var c=this._listeners[a];c==null?this._listeners[a]=[b]:c.indexOf(b)==-1&&c.unshift(b)},removeEventListener:function(a,b){var c=this._listeners[a];if(c!=null){var d=c.indexOf(b);d!=-1&&c.splice(d,1)}},clearEventListener:function(a){a!=null?delete this._listeners[a]:this._listeners={}},dispatchEvent:function(a){a.target=this;a.localX=a.x-this._offsetX;a.localY=a.y-this._offsetY;if(this["on"+a.type]!=null)this["on"+a.type](a);var b=this._listeners[a.type];if(b!=null)for(var b=
b.slice(),c=0,d=b.length;c<d;c++)b[c].call(this,a)}});enchant.Game=enchant.Class.create(enchant.EventTarget,{initialize:function(a,b){if(window.document.body===null)throw Error("document.body is null. Please excute 'new Game()' in window.onload.");enchant.EventTarget.call(this);var c=true;if(e){c=false;e.stop()}e=enchant.Game.instance=this;this.width=a||320;this.height=b||320;this.scale=1;var d=document.getElementById("enchant-stage");if(d){var q=window.getComputedStyle(d),a=parseInt(q.width),b=parseInt(q.height);
if(a&&b)this.scale=Math.min(a/this.width,b/this.height);else{d.style.width=this.width+"px";d.style.height=this.height+"px"}for(;d.firstChild;)d.removeChild(d.firstChild);d.style.position="relative";q=d.getBoundingClientRect();this._pageX=Math.round(window.scrollX+q.left);this._pageY=Math.round(window.scrollY+q.top)}else{d=document.createElement("div");d.id="enchant-stage";d.style.width=window.innerWidth+"px";d.style.height=window.innerHeight+"px";d.style.position="absolute";document.body.firstChild?
document.body.insertBefore(d,document.body.firstChild):document.body.appendChild(d);this.scale=Math.min(window.innerWidth/this.width,window.innerHeight/this.height);this._pageY=this._pageX=0}if(!this.scale)this.scale=1;d.style.fontSize="12px";d.style.webkitTextSizeAdjust="none";this._element=d;this.fps=30;this.frame=0;this.ready=null;this.running=false;this.assets={};var i=this._assets=[];(function w(a){a.assets instanceof Array&&[].push.apply(i,a.assets);for(var b in a)a.hasOwnProperty(b)&&typeof a[b]==
"object"&&Object.getPrototypeOf(a[b])==Object.prototype&&w(a[b])})(enchant);this._scenes=[];this.currentScene=null;this.rootScene=new enchant.Scene;this.pushScene(this.rootScene);this.loadingScene=new enchant.Scene;this.loadingScene.backgroundColor="#000";var h=this.width*0.9|0,r=this.width*0.3|0,l=h*0.05|0,d=new enchant.Sprite(h,r);d.x=(this.width-h)/2;d.y=(this.height-r)/2;var j=new enchant.Surface(h,r);j.context.fillStyle="#fff";j.context.fillRect(0,0,h,r);j.context.fillStyle="#000";j.context.fillRect(l,
l,h-l*2,r-l*2);d.image=j;var f=0,g=0;this.addEventListener("progress",function(a){f=a.loaded/a.total});d.addEventListener("enterframe",function(){g=g*0.9;g=g+f*0.1;j.context.fillStyle="#fff";j.context.fillRect(l,0,(h-l*2)*g,r)});this.loadingScene.addChild(d);this._soundID=this._surfaceID=this._mousedownID=0;this._intervalID=null;this._offsetY=this._offsetX=0;this.input={};this._keybind={};this.keybind(37,"left");this.keybind(38,"up");this.keybind(39,"right");this.keybind(40,"down");var k=0;["left",
"right","up","down","a","b"].forEach(function(a){this.addEventListener(a+"buttondown",function(b){var c;if(!this.input[a]){this.input[a]=true;c=new enchant.Event(k++?"inputchange":"inputstart");this.dispatchEvent(c)}this.currentScene.dispatchEvent(b);c&&this.currentScene.dispatchEvent(c)});this.addEventListener(a+"buttonup",function(b){var c;if(this.input[a]){this.input[a]=false;c=new enchant.Event(--k?"inputchange":"inputend");this.dispatchEvent(c)}this.currentScene.dispatchEvent(b);c&&this.currentScene.dispatchEvent(c)})},
this);if(c){d=enchant.Game.instance._element;document.addEventListener("keydown",function(a){e.dispatchEvent(new enchant.Event("keydown"));if(37<=a.keyCode&&a.keyCode<=40||a.keyCode==32){a.preventDefault();a.stopPropagation()}if(e.running)if(a=e._keybind[a.keyCode]){a=new enchant.Event(a+"buttondown");e.dispatchEvent(a)}},true);document.addEventListener("keyup",function(a){if(e.running)if(a=e._keybind[a.keyCode]){a=new enchant.Event(a+"buttonup");e.dispatchEvent(a)}},true);if(m){d.addEventListener("touchstart",
function(a){var b=a.target.tagName.toLowerCase();b!=="input"&&b!=="textarea"&&a.preventDefault()},true);d.addEventListener("touchmove",function(a){var b=a.target.tagName.toLowerCase();if(b!=="input"&&b!=="textarea"){a.preventDefault();e.running||a.stopPropagation()}},true);d.addEventListener("touchend",function(a){var b=a.target.tagName.toLowerCase();if(b!=="input"&&b!=="textarea"){a.preventDefault();e.running||a.stopPropagation()}},true)}else{d.addEventListener("mousedown",function(a){var b=a.target.tagName.toLowerCase();
if(b!=="input"&&b!=="textarea"){a.preventDefault();e._mousedownID++;e.running||a.stopPropagation()}},true);d.addEventListener("mousemove",function(a){var b=a.target.tagName.toLowerCase();if(b!=="input"&&b!=="textarea"){a.preventDefault();e.running||a.stopPropagation()}},true);d.addEventListener("mouseup",function(a){var b=a.target.tagName.toLowerCase();if(b!=="input"&&b!=="textarea"){a.preventDefault();e.running||a.stopPropagation()}},true)}}},preload:function(a){a instanceof Array||(a=Array.prototype.slice.call(arguments));
[].push.apply(this._assets,a)},load:function(a,b){b==null&&(b=function(){});var c=g(a);if(enchant.Game._loadFuncs[c])enchant.Game._loadFuncs[c].call(this,a,b,c);else{var d=new XMLHttpRequest;d.open("GET",a,true);d.onreadystatechange=function(){if(d.readyState==4){if(d.status!=200&&d.status!=0)throw Error(d.status+": Cannot load an asset: "+a);var c=d.getResponseHeader("Content-Type")||"";if(c.match(/^image/)){e.assets[a]=enchant.Surface.load(a);e.assets[a].addEventListener("load",b)}else if(c.match(/^audio/)){e.assets[a]=
enchant.Sound.load(a,c);e.assets[a].addEventListener("load",b)}else{e.assets[a]=d.responseText;b()}}};d.send(null)}},start:function(){if(this._intervalID)window.clearInterval(this._intervalID);else if(this._assets.length){if(enchant.Sound.enabledInMobileSafari&&!e._touched&&k=="webkit"&&m){var a=new enchant.Scene;a.backgroundColor="#000";var b=Math.round(e.width/10),c=new enchant.Sprite(e.width,b);c.y=(e.height-b)/2;c.image=new enchant.Surface(e.width,b);c.image.context.fillStyle="#fff";c.image.context.font=
b-1+"px bold Helvetica,Arial,sans-serif";var d=c.image.context.measureText("Touch to Start").width;c.image.context.fillText("Touch to Start",(e.width-d)/2,b-1);a.addChild(c);document.addEventListener("touchstart",function(){e._touched=true;e.removeScene(a);e.start()},true);e.pushScene(a);return}var q={},b=this._assets.filter(function(a){return a in q?false:q[a]=true}),i=0,c=0,h=b.length;for(;c<h;c++)this.load(b[c],function(){var a=new enchant.Event("progress");a.loaded=++i;a.total=h;e.dispatchEvent(a);
if(i==h){e.removeScene(e.loadingScene);e.dispatchEvent(new enchant.Event("load"))}});this.pushScene(this.loadingScene)}else this.dispatchEvent(new enchant.Event("load"));this.currentTime=Date.now();this._intervalID=window.setInterval(function(){e._tick()},1E3/this.fps);this.running=true},debug:function(){this._debug=true;this.rootScene.addEventListener("enterframe",function(a){this._actualFps=1/a});this.start()},actualFps:{get:function(){return this._actualFps||this.fps}},_tick:function(){var a=Date.now(),
b=new enchant.Event("enterframe");b.elapsed=a-this.currentTime;this.currentTime=a;for(var a=this.currentScene.childNodes.slice(),c=Array.prototype.push;a.length;){var d=a.pop();d.dispatchEvent(b);d.age++;d.childNodes&&c.apply(a,d.childNodes)}this.currentScene.dispatchEvent(b);this.dispatchEvent(b);this.dispatchEvent(new enchant.Event("exitframe"));this.frame++},stop:function(){if(this._intervalID){window.clearInterval(this._intervalID);this._intervalID=null}this.running=false},pause:function(){if(this._intervalID){window.clearInterval(this._intervalID);
this._intervalID=null}},resume:function(){this.currentTime=Date.now();this._intervalID=window.setInterval(function(){e._tick()},1E3/this.fps);this.running=true},pushScene:function(a){this._element.appendChild(a._element);this.currentScene&&this.currentScene.dispatchEvent(new enchant.Event("exit"));this.currentScene=a;this.currentScene.dispatchEvent(new enchant.Event("enter"));return this._scenes.push(a)},popScene:function(){if(this.currentScene==this.rootScene)return this.currentScene;this._element.removeChild(this.currentScene._element);
this.currentScene.dispatchEvent(new enchant.Event("exit"));this.currentScene=this._scenes[this._scenes.length-2];this.currentScene.dispatchEvent(new enchant.Event("enter"));return this._scenes.pop()},replaceScene:function(a){this.popScene();return this.pushScene(a)},removeScene:function(a){if(this.currentScene==a)return this.popScene();var b=this._scenes.indexOf(a);if(b!=-1){this._scenes.splice(b,1);this._element.removeChild(a._element);return a}},keybind:function(a,b){this._keybind[a]=b},getElapsedTime:function(){return this.frame/
this.fps}});enchant.Game._loadFuncs={};enchant.Game._loadFuncs.jpg=enchant.Game._loadFuncs.jpeg=enchant.Game._loadFuncs.gif=enchant.Game._loadFuncs.png=enchant.Game._loadFuncs.bmp=function(a,b){this.assets[a]=enchant.Surface.load(a);this.assets[a].addEventListener("load",b)};enchant.Game._loadFuncs.mp3=enchant.Game._loadFuncs.aac=enchant.Game._loadFuncs.m4a=enchant.Game._loadFuncs.wav=enchant.Game._loadFuncs.ogg=function(a,b,c){this.assets[a]=enchant.Sound.load(a,"audio/"+c);this.assets[a].addEventListener("load",
b)};enchant.Game._loadFuncs.js=function(a,b){var c=document.createElement("script");c.type="text/javascript";c.src=a;c.onload=b;c.onerror=function(){throw Error("Cannot load an asset: "+a);};document.body.appendChild(c)};enchant.Game.instance=null;enchant.Node=enchant.Class.create(enchant.EventTarget,{initialize:function(){enchant.EventTarget.call(this);this.age=this._offsetY=this._offsetX=this._y=this._x=0;this.scene=this.parentNode=null;this.addEventListener("touchstart",function(a){this.parentNode&&
this.parentNode!=this.scene&&this.parentNode.dispatchEvent(a)});this.addEventListener("touchmove",function(a){this.parentNode&&this.parentNode!=this.scene&&this.parentNode.dispatchEvent(a)});this.addEventListener("touchend",function(a){this.parentNode&&this.parentNode!=this.scene&&this.parentNode.dispatchEvent(a)})},moveTo:function(a,b){this._x=a;this._y=b;this._updateCoordinate()},moveBy:function(a,b){this._x=this._x+a;this._y=this._y+b;this._updateCoordinate()},x:{get:function(){return this._x},
set:function(a){this._x=a;this._updateCoordinate()}},y:{get:function(){return this._y},set:function(a){this._y=a;this._updateCoordinate()}},_updateCoordinate:function(){if(this.parentNode){this._offsetX=this.parentNode._offsetX+this._x;this._offsetY=this.parentNode._offsetY+this._y}else{this._offsetX=this._x;this._offsetY=this._y}},remove:function(){this._listener&&this.clearEventListener();this.parentNode&&this.parentNode.removeChild(this)}});enchant.Entity=enchant.Class.create(enchant.Node,{initialize:function(){enchant.Node.call(this);
this._element=document.createElement("div");this._style=this._element.style;this._style.position="absolute";this._height=this._width=0;this._backgroundColor=null;this._opacity=1;this._visible=true;this._buttonMode=null;if(enchant.Game.instance._debug){this._style.border="1px solid blue";this._style.margin="-1px"}this.buttonMode=null;this.buttonPressed=false;this.addEventListener("touchstart",function(){if(this.buttonMode){this.buttonPressed=true;var a=new enchant.Event(this.buttonMode+"buttondown");
this.dispatchEvent(a);e.dispatchEvent(a)}});this.addEventListener("touchend",function(){if(this.buttonMode){this.buttonPressed=false;var a=new enchant.Event(this.buttonMode+"buttonup");this.dispatchEvent(a);e.dispatchEvent(a)}});var a=function(){this.dispatchEvent(new enchant.Event("render"))}.bind(this);this.addEventListener("addedtoscene",function(){a();e.addEventListener("exitframe",a)});this.addEventListener("removedfromscene",function(){e.removeEventListener("exitframe",a)});this.addEventListener("render",
function(){if(this._offsetX!=this._previousOffsetX)this._style.left=this._offsetX+"px";if(this._offsetY!=this._previousOffsetY)this._style.top=this._offsetY+"px";this._previousOffsetX=this._offsetX;this._previousOffsetY=this._offsetY});if(m){this._element.addEventListener("touchstart",function(a){for(var c=a.touches,d=0,e=c.length;d<e;d++){a=new enchant.Event("touchstart");a.identifier=c[d].identifier;a._initPosition(c[d].pageX,c[d].pageY);this.dispatchEvent(a)}}.bind(this),false);this._element.addEventListener("touchmove",
function(a){for(var c=a.touches,d=0,e=c.length;d<e;d++){a=new enchant.Event("touchmove");a.identifier=c[d].identifier;a._initPosition(c[d].pageX,c[d].pageY);this.dispatchEvent(a)}}.bind(this),false);this._element.addEventListener("touchend",function(a){for(var c=a.changedTouches,d=0,e=c.length;d<e;d++){a=new enchant.Event("touchend");a.identifier=c[d].identifier;a._initPosition(c[d].pageX,c[d].pageY);this.dispatchEvent(a)}}.bind(this),false)}else{this._element.addEventListener("mousedown",function(a){var c=
a.pageX,d=a.pageY,a=new enchant.Event("touchstart");a.identifier=e._mousedownID;a._initPosition(c,d);this.dispatchEvent(a);this._mousedown=true}.bind(this),false);e._element.addEventListener("mousemove",function(a){if(this._mousedown){var c=a.pageX,d=a.pageY,a=new enchant.Event("touchmove");a.identifier=e._mousedownID;a._initPosition(c,d);this.dispatchEvent(a)}}.bind(this),false);e._element.addEventListener("mouseup",function(a){if(this._mousedown){var c=a.pageX,d=a.pageY,a=new enchant.Event("touchend");
a.identifier=e._mousedownID;a._initPosition(c,d);this.dispatchEvent(a);this._mousedown=false}}.bind(this),false)}},id:{get:function(){return this._element.id},set:function(a){this._element.id=a}},className:{get:function(){return this._element.className},set:function(a){this._element.className=a}},width:{get:function(){return this._width},set:function(a){this._style.width=(this._width=a)+"px"}},height:{get:function(){return this._height},set:function(a){this._style.height=(this._height=a)+"px"}},backgroundColor:{get:function(){return this._backgroundColor},
set:function(a){this._element.style.backgroundColor=this._backgroundColor=a}},opacity:{get:function(){return this._opacity},set:function(a){this._style.opacity=this._opacity=a}},visible:{get:function(){return this._visible},set:function(a){this._style.display=(this._visible=a)?"block":"none"}},touchEnabled:{get:function(){return this._touchEnabled},set:function(a){this._style.pointerEvents=(this._touchEnabled=a)?"all":"none"}},intersect:function(a){return this.x<a.x+a.width&&a.x<this.x+this.width&&
this.y<a.y+a.height&&a.y<this.y+this.height},within:function(a,b){b==null&&(b=(this.width+this.height+a.width+a.height)/4);var c;return(c=this.x-a.x+(this.width-a.width)/2)*c+(c=this.y-a.y+(this.height-a.height)/2)*c<b*b}});enchant.Sprite=enchant.Class.create(enchant.Entity,{initialize:function(a,b){enchant.Entity.call(this);this.width=a;this.height=b;this._scaleY=this._scaleX=1;this._rotation=0;this._dirty=false;this._image=null;this._frame=0;this._frameSequence=[];this._style.overflow="hidden";
this.addEventListener("render",function(){if(this._dirty){this._style[k+"Transform"]=["rotate(",this._rotation,"deg)scale(",this._scaleX,",",this._scaleY,")"].join("");this._dirty=false}});this.addEventListener("enterframe",function(){if(this._frameSequence.length!==0){var a=this._frameSequence.shift();if(a===null)this._frameSequence=[];else{this._setFrame(a);this._frameSequence.push(a)}}});if(enchant.Game.instance._debug){this._style.border="1px solid red";this._style.margin="-1px";this.addEventListener("touchstart",
function(){enchant.Game.instance.running||console.log("touchstart",this)})}},image:{get:function(){return this._image},set:function(a){if(a!=this._image){if(this._image!=null)if(this._image.css)this._style.backgroundImage="";else if(this._element.firstChild){this._element.removeChild(this._element.firstChild);if(this._dirtyListener){this.removeEventListener("render",this._dirtyListener);this._dirtyListener=null}else this._image._parent=null}if(a!=null)if(a._css)this._style.backgroundImage=a._css;
else if(a._parent){var b=document.createElement("canvas"),c=b.getContext("2d");b.width=a.width;b.height=a.height;c.drawImage(a._element,0,0);this._dirtyListener=function(){if(a._dirty){c.drawImage(a._element);a._dirty=false}};this.addEventListener("render",this._dirtyListener);this._element.appendChild(b)}else{a._parent=this;this._element.appendChild(a._element)}this._image=a;this.frame=this.frame}}},frame:{get:function(){return this._frame},set:function(a){if(a instanceof Array){var b=a.shift();
this._setFrame(b);a.push(b);this._frameSequence=a}else{this._setFrame(a);this._frameSequence=[];this._frame=a}}},_setFrame:function(a){if(this._image!=null){this._frame=a;var b=this._image.width/this._width|0;if(this._image._css)this._style.backgroundPosition=[-(a%b)*this._width,"px ",-(a/b|0)*this._height,"px"].join("");else if(this._element.firstChild){var c=this._element.firstChild.style;c.left=-(a%b)*this._width+"px";c.top=-(a/b|0)*this._height+"px"}}},scale:function(a,b){b==null&&(b=a);this._scaleX=
this._scaleX*a;this._scaleY=this._scaleY*b;this._dirty=true},rotate:function(a){this._rotation=this._rotation+a;this._dirty=true},scaleX:{get:function(){return this._scaleX},set:function(a){this._scaleX=a;this._dirty=true}},scaleY:{get:function(){return this._scaleY},set:function(a){this._scaleY=a;this._dirty=true}},rotation:{get:function(){return this._rotation},set:function(a){this._rotation=a;this._dirty=true}}});enchant.Label=enchant.Class.create(enchant.Entity,{initialize:function(a){enchant.Entity.call(this);
this.width=300;this.text=a;this.textAlign="left"},text:{get:function(){return this._element.innerHTML},set:function(a){this._element.innerHTML=a}},textAlign:{get:function(){return this._style.textAlign},set:function(a){this._style.textAlign=a}},font:{get:function(){return this._style.font},set:function(a){this._style.font=a}},color:{get:function(){return this._style.color},set:function(a){this._style.color=a}}});enchant.Map=enchant.Class.create(enchant.Entity,{initialize:function(a,b){enchant.Entity.call(this);
var c=document.createElement("canvas");if(p&&e.scale==2){c.width=e.width*2;c.height=e.height*2;this._style.webkitTransformOrigin="0 0";this._style.webkitTransform="scale(0.5)"}else{c.width=e.width;c.height=e.height}this._element.appendChild(c);this._context=c.getContext("2d");this._tileWidth=a||0;this._tileHeight=b||0;this._image=null;this._data=[[[]]];this.touchEnabled=this._tight=this._dirty=false;this.collisionData=null;this._listeners.render=null;this.addEventListener("render",function(){if(this._dirty||
this._previousOffsetX==null){this._dirty=false;this.redraw(0,0,e.width,e.height)}else if(this._offsetX!=this._previousOffsetX||this._offsetY!=this._previousOffsetY)if(this._tight){var a=-this._offsetX,b=-this._offsetY,c=-this._previousOffsetX,h=-this._previousOffsetY,g=a-c+e.width,l=c-a+e.width,j=b-h+e.height,f=h-b+e.height;if(g>this._tileWidth&&l>this._tileWidth&&j>this._tileHeight&&f>this._tileHeight){var k;if(g<l){k=0;a=c-a;l=g}else{k=a-c;a=0}if(j<f){g=0;b=h-b}else{g=b-h;b=0;j=f}if(e._buffer==
null){e._buffer=document.createElement("canvas");e._buffer.width=this._context.canvas.width;e._buffer.height=this._context.canvas.height}f=e._buffer.getContext("2d");if(this._doubledImage){f.clearRect(0,0,l*2,j*2);f.drawImage(this._context.canvas,k*2,g*2,l*2,j*2,0,0,l*2,j*2);f=this._context;f.clearRect(a*2,b*2,l*2,j*2);f.drawImage(e._buffer,0,0,l*2,j*2,a*2,b*2,l*2,j*2)}else{f.clearRect(0,0,l,j);f.drawImage(this._context.canvas,k,g,l,j,0,0,l,j);f=this._context;f.clearRect(a,b,l,j);f.drawImage(e._buffer,
0,0,l,j,a,b,l,j)}a==0?this.redraw(l,0,e.width-l,e.height):this.redraw(0,0,e.width-l,e.height);b==0?this.redraw(0,j,e.width,e.height-j):this.redraw(0,0,e.width,e.height-j)}else this.redraw(0,0,e.width,e.height)}else this.redraw(0,0,e.width,e.height);this._previousOffsetX=this._offsetX;this._previousOffsetY=this._offsetY})},loadData:function(a){this._data=Array.prototype.slice.apply(arguments);this._dirty=true;this._tight=false;for(var b=0,c=this._data.length;b<c;b++){for(var d=0,a=this._data[b],e=
0,i=a.length;e<i;e++)for(var h=0,f=a[e].length;h<f;h++)a[e][h]>=0&&d++;if(d/(a.length*a[0].length)>0.2){this._tight=true;break}}},hitTest:function(a,b){if(a<0||this.width<=a||b<0||this.height<=b)return false;var c=this._image.width,d=this._image.height,e=this._tileWidth||c,i=this._tileHeight||d,a=a/e|0,b=b/i|0;if(this.collisionData!=null)return this.collisionData[b]&&!!this.collisionData[b][a];for(var h=0,f=this._data.length;h<f;h++){var g=this._data[h],j;if(g[b]!=null&&(j=g[b][a])!=null&&0<=j&&j<
(c/e|0)*(d/i|0))return true}return false},image:{get:function(){return this._image},set:function(a){this._image=a;if(p&&e.scale==2){for(var b=new enchant.Surface(a.width*2,a.height*2),c=this._tileWidth||a.width,d=this._tileHeight||a.height,f=a.width/c|0,i=a.height/d|0,h=0;h<i;h++)for(var g=0;g<f;g++)b.draw(a,g*c,h*d,c,d,g*c*2,h*d*2,c*2,d*2);this._doubledImage=b}this._dirty=true}},tileWidth:{get:function(){return this._tileWidth},set:function(a){this._tileWidth=a;this._dirty=true}},tileHeight:{get:function(){return this._tileHeight},
set:function(a){this._tileHeight=a;this._dirty=true}},width:{get:function(){return this._tileWidth*this._data[0][0].length}},height:{get:function(){return this._tileHeight*this._data[0].length}},redraw:function(a,b,c,d){if(this._image!=null){var e,i,h,f,g;if(this._doubledImage){e=this._doubledImage;i=this._tileWidth*2;h=this._tileHeight*2;f=-this._offsetX*2;g=-this._offsetY*2;a=a*2;b=b*2;c=c*2;d=d*2}else{e=this._image;i=this._tileWidth;h=this._tileHeight;f=-this._offsetX;g=-this._offsetY}var j=e.width/
i|0,k=e.height/h|0,m=Math.max((a+f)/i|0,0),n=Math.max((b+g)/h|0,0),o=Math.ceil((a+f+c)/i),p=Math.ceil((b+g+d)/h);e=e._element;var v=this._context;v.clearRect(a,b,c,d);c=0;for(d=this._data.length;c<d;c++)for(var t=this._data[c],u=Math.min(o,t[0].length),x=Math.min(p,t.length),b=n;b<x;b++)for(a=m;a<u;a++){var s=t[b][a];0<=s&&s<j*k&&v.drawImage(e,s%j*i,(s/j|0)*h,i,h,a*i-f,b*h-g,i,h)}}}});enchant.Group=enchant.Class.create(enchant.Node,{initialize:function(){enchant.Node.call(this);this.childNodes=[];
this._y=this._x=0},addChild:function(a){this.childNodes.push(a);a.parentNode=this;a.dispatchEvent(new enchant.Event("added"));if(this.scene){var b=new enchant.Event("addedtoscene");a.scene=this.scene;a.dispatchEvent(b);a._updateCoordinate();var c=document.createDocumentFragment(),d,e=Array.prototype.push;if(a._element)c.appendChild(a._element);else if(a.childNodes)for(d=a.childNodes.slice().reverse();d.length;){a=d.pop();a.scene=this.scene;a.dispatchEvent(b);a._element?c.appendChild(a._element):a.childNodes&&
e.apply(d,a.childNodes.reverse())}if(c.childNodes.length){for(var f,b=this;b.parentNode;){d=b.parentNode.childNodes;for(d=d.slice(d.indexOf(b)+1).reverse();d.length;){a=d.pop();if(a._element){f=a._element;break}else a.childNodes&&e.apply(d,a.childNodes.slice().reverse())}b=b.parentNode}f?this.scene._element.insertBefore(c,f):this.scene._element.appendChild(c)}}},insertBefore:function(a,b){var c=this.childNodes.indexOf(b);if(c!=-1){this.childNodes.splice(c,0,a);a.parentNode=this;a.dispatchEvent(new enchant.Event("added"));
if(this.scene){var d=new enchant.Event("addedtoscene");a.scene=this.scene;a.dispatchEvent(d);a._updateCoordinate();var e=document.createDocumentFragment(),f,g=Array.prototype.push;if(a._element)e.appendChild(a._element);else if(a.childNodes)for(f=a.childNodes.slice().reverse();f.length;){a=f.pop();a.scene=this.scene;a.dispatchEvent(d);a._element?e.appendChild(a._element):a.childNodes&&g.apply(f,a.childNodes.reverse())}if(e.childNodes.length){for(var k,d=b;d!=this;){if(c!=null){f=this.childNodes.slice(c+
1).reverse();c=null}else{f=d.parentNode.childNodes;f=f.slice(f.indexOf(d)+1).reverse()}for(;f.length;){a=f.pop();if(a._element){k=a._element;break}else a.childNodes&&g.apply(f,a.childNodes.slice().reverse())}d=d.parentNode}k?this.scene._element.insertBefore(e,k):this.scene._element.appendChild(e)}}}else this.addChild(a)},removeChild:function(a){var b=this.childNodes.indexOf(a);if(b!=-1){this.childNodes.splice(b,1);a.parentNode=null;a.dispatchEvent(new enchant.Event("removed"));if(this.scene){b=new enchant.Event("removedfromscene");
a.scene=null;a.dispatchEvent(b);if(a._element)this.scene._element.removeChild(a._element);else if(a.childNodes)for(var c=a.childNodes.slice(),d=Array.prototype.push;c.length;){a=c.pop();a.scene=null;a.dispatchEvent(b);a._element?this.scene._element.removeChild(a._element):a.childNodes&&d.apply(c,a.childNodes)}}}},firstChild:{get:function(){return this.childNodes[0]}},lastChild:{get:function(){return this.childNodes[this.childNodes.length-1]}},_updateCoordinate:function(){if(this.parentNode){this._offsetX=
this.parentNode._offsetX+this._x;this._offsetY=this.parentNode._offsetY+this._y}else{this._offsetX=this._x;this._offsetY=this._y}for(var a=0,b=this.childNodes.length;a<b;a++)this.childNodes[a]._updateCoordinate()}});enchant.RGroup=enchant.Class.create(enchant.Group,{initialize:function(a,b){enchant.Group.call(this);if(arguments.length<2)throw"Width and height of RGroup must be specified";this.width=a;this.height=b;this.rotationOrigin={x:a/2,y:b/2};this._rotation=0},addChild:function(a){enchant.Group.prototype.addChild.apply(this,
arguments);a.transformOrigin="0 0"},rotation:{get:function(){return this._rotation},set:function(a){var b=a-this._rotation;if(b!=0){for(var c=b/180*Math.PI,d=Math.sin(c),c=Math.cos(c),e=this.width/2,f=this.height/2,g=0,k=this.childNodes.length;g<k;g++){var l=this.childNodes[g];l.rotation=l.rotation-b;var j=l.x-e,m=l.y-f;l.x=+c*j+d*m+e;l.y=-d*j+c*m+f}this._rotation=a}}}});enchant.Scene=enchant.Class.create(enchant.Group,{initialize:function(){enchant.Group.call(this);this._element=document.createElement("div");
this._element.style.position="absolute";this._element.style.overflow="hidden";this._element.style.width=(this.width=e.width)+"px";this._element.style.height=(this.height=e.height)+"px";this._element.style[k+"TransformOrigin"]="0 0";this._element.style[k+"Transform"]="scale("+e.scale+")";this.scene=this;if(m){this._element.addEventListener("touchstart",function(a){for(var b=a.touches,c=0,d=b.length;c<d;c++){a=new enchant.Event("touchstart");a.identifier=b[c].identifier;a._initPosition(b[c].pageX,b[c].pageY);
this.dispatchEvent(a)}}.bind(this),false);this._element.addEventListener("touchmove",function(a){for(var b=a.touches,c=0,d=b.length;c<d;c++){a=new enchant.Event("touchmove");a.identifier=b[c].identifier;a._initPosition(b[c].pageX,b[c].pageY);this.dispatchEvent(a)}}.bind(this),false);this._element.addEventListener("touchend",function(a){for(var b=a.changedTouches,c=0,d=b.length;c<d;c++){a=new enchant.Event("touchend");a.identifier=b[c].identifier;a._initPosition(b[c].pageX,b[c].pageY);this.dispatchEvent(a)}}.bind(this),
false)}else{this._element.addEventListener("mousedown",function(a){var b=a.pageX,c=a.pageY,a=new enchant.Event("touchstart");a.identifier=e._mousedownID;a._initPosition(b,c);this.dispatchEvent(a);this._mousedown=true}.bind(this),false);e._element.addEventListener("mousemove",function(a){if(this._mousedown){var b=a.pageX,c=a.pageY,a=new enchant.Event("touchmove");a.identifier=e._mousedownID;a._initPosition(b,c);this.dispatchEvent(a)}}.bind(this),false);e._element.addEventListener("mouseup",function(a){if(this._mousedown){var b=
a.pageX,c=a.pageY,a=new enchant.Event("touchend");a.identifier=e._mousedownID;a._initPosition(b,c);this.dispatchEvent(a);this._mousedown=false}}.bind(this),false)}},backgroundColor:{get:function(){return this._backgroundColor},set:function(a){this._element.style.backgroundColor=this._backgroundColor=a}},_updateCoordinate:function(){this._offsetX=this._x;this._offsetY=this._y;for(var a=0,b=this.childNodes.length;a<b;a++)this.childNodes[a]._updateCoordinate()}});var u=["putImageData","drawImage","drawFocusRing",
"fill","stroke","clearRect","fillRect","strokeRect","fillText","strokeText"];enchant.Surface=enchant.Class.create(enchant.EventTarget,{initialize:function(a,b){enchant.EventTarget.call(this);this.width=a;this.height=b;this.context=null;var c="enchant-surface"+e._surfaceID++;if(document.getCSSCanvasContext){this.context=document.getCSSCanvasContext("2d",c,a,b);this._element=this.context.canvas;this._css="-webkit-canvas("+c+")"}else if(document.mozSetImageElement){this._element=document.createElement("canvas");
this._element.width=a;this._element.height=b;this._css="-moz-element(#"+c+")";this.context=this._element.getContext("2d");document.mozSetImageElement(c,this._element)}else{this._element=document.createElement("canvas");this._element.width=a;this._element.height=b;this._element.style.position="absolute";this.context=this._element.getContext("2d");u.forEach(function(a){var b=this.context[a];this.context[a]=function(){b.apply(this,arguments);this._dirty=true}},this)}},getPixel:function(a,b){return this.context.getImageData(a,
b,1,1).data},setPixel:function(a,b,c,d,e,f){var g=this.context.createImageData(1,1);g.data[0]=c;g.data[1]=d;g.data[2]=e;g.data[3]=f;this.context.putImageData(g,a,b)},clear:function(){this.context.clearRect(0,0,this.width,this.height)},draw:function(a){arguments[0]=a=a._element;arguments.length==1?this.context.drawImage(a,0,0):this.context.drawImage.apply(this.context,arguments)},clone:function(){var a=new enchant.Surface(this.width,this.height);a.draw(this);return a},toDataURL:function(){var a=this._element.src;
return a?a.slice(0,5)=="data:"?a:this.clone().toDataURL():this._element.toDataURL()}});enchant.Surface.load=function(a){var b=new Image,c=Object.create(enchant.Surface.prototype,{context:{value:null},_css:{value:"url("+a+")"},_element:{value:b}});enchant.EventTarget.call(c);b.src=a;b.onerror=function(){throw Error("Cannot load an asset: "+b.src);};b.onload=function(){c.width=b.width;c.height=b.height;c.dispatchEvent(new enchant.Event("load"))};return c};enchant.Sound=enchant.Class.create(enchant.EventTarget,
{initialize:function(){enchant.EventTarget.call(this);throw Error("Illegal Constructor");},play:function(){this._element&&this._element.play()},pause:function(){this._element&&this._element.pause()},stop:function(){this.pause();this.currentTime=0},clone:function(){var a;if(this._element instanceof Audio)a=Object.create(enchant.Sound.prototype,{_element:{value:this._element.cloneNode(false)},duration:{value:this.duration}});else{if(o)return this;a=Object.create(enchant.Sound.prototype)}enchant.EventTarget.call(a);
return a},currentTime:{get:function(){return this._element?this._element.currentTime:0},set:function(a){if(this._element)this._element.currentTime=a}},volume:{get:function(){return this._element?this._element.volume:1},set:function(a){if(this._element)this._element.volume=a}}});enchant.Sound.load=function(a,b){if(b==null)var c=g(a),b=c?"audio/"+c:"";var b=b.replace("mp3","mpeg"),d=Object.create(enchant.Sound.prototype);enchant.EventTarget.call(d);var f=new Audio;if(!enchant.Sound.enabledInMobileSafari&&
k=="webkit"&&m)window.setTimeout(function(){d.dispatchEvent(new enchant.Event("load"))},0);else if(!o&&f.canPlayType(b)){f.src=a;f.load();f.autoplay=false;f.onerror=function(){throw Error("Cannot load an asset: "+f.src);};f.addEventListener("canplaythrough",function(){d.duration=f.duration;d.dispatchEvent(new enchant.Event("load"))},false);d._element=f}else if(b=="audio/mpeg"){var i=document.createElement("embed"),c="enchant-audio"+e._soundID++;i.width=i.height=1;i.name=c;i.src="sound.swf?id="+c+
"&src="+a;i.allowscriptaccess="always";i.style.position="absolute";i.style.left="-1px";d.addEventListener("load",function(){Object.defineProperties(i,{currentTime:{get:function(){return i.getCurrentTime()},set:function(a){i.setCurrentTime(a)}},volume:{get:function(){return i.getVolume()},set:function(a){i.setVolume(a)}}});d._element=i;d.duration=i.getDuration()});e._element.appendChild(i);enchant.Sound[c]=d}else window.setTimeout(function(){d.dispatchEvent(new enchant.Event("load"))},0);return d};
window.addEventListener("message",function(a){a=JSON.parse(a.data);if(a.type=="event")e.dispatchEvent(new Event(a.value));else if(a.type=="debug")switch(a.value){case "start":enchant.Game.instance.start();break;case "pause":enchant.Game.instance.pause();break;case "resume":enchant.Game.instance.resume();break;case "tick":enchant.Game.instance._tick()}},false);enchant.Sound.enabledInMobileSafari=false})();
=======
/* enchant.js v0.5.1 http://enchantjs.com Licensed under MIT or GPLv3. (c) Ubiquitous Entertainment Inc. */
typeof Object.defineProperty!="function"&&(Object.defineProperty=function(e,t,n){return"value"in n&&(e[t]=n.value),"get"in n&&e.__defineGetter__(t,n.get),"set"in n&&e.__defineSetter__(t,n.set),e}),typeof Object.defineProperties!="function"&&(Object.defineProperties=function(e,t){for(var n in t)t.hasOwnProperty(n)&&Object.defineProperty(e,n,t[n]);return e}),typeof Object.create!="function"&&(Object.create=function(e,t){function n(){}n.prototype=e;var r=new n;return t!=null&&Object.defineProperties(r,t),r}),typeof Object.getPrototypeOf!="function"&&(Object.getPrototypeOf=function(e){return e.__proto__}),typeof Function.prototype.bind!="function"&&(Function.prototype.bind=function(e){var t=this,n=Array.prototype.slice.call(arguments,1),r=function(){},i=function(){var i=n.concat(Array.prototype.slice.call(arguments));return t.apply(this instanceof r?this:e||window,i)};return r.prototype=t.prototype,i.prototype=new r,i});var enchant=function(e){e!=null&&(e instanceof Array||(e=Array.prototype.slice.call(arguments)),e=e.filter(function(e){return[e].join()})),function t(n,r){var i=[],s,o;for(var u in n)n.hasOwnProperty(u)&&(typeof n[u]=="function"?window[u]=n[u]:typeof n[u]=="object"&&Object.getPrototypeOf(n[u])===Object.prototype&&(e==null?i.push(u):(s=e.indexOf(r+u),s!==-1&&(i.push(u),e.splice(s,1)))));for(s=0,o=i.length;s<o;s++)t(n[i[s]],r+i[s]+".")}(enchant,"");if(e!=null&&e.length)throw new Error("Cannot load module: "+e.join(", "))};window.addEventListener("message",function(e,t){try{var n=JSON.parse(e.data);if(n.type==="event")enchant.Game.instance.dispatchEvent(new enchant.Event(n.value));else if(n.type==="debug")switch(n.value){case"start":enchant.Game.instance.start();break;case"pause":enchant.Game.instance.pause();break;case"resume":enchant.Game.instance.resume();break;case"tick":enchant.Game.instance._tick();break;default:}}catch(r){}},!1),enchant.Class=function(e,t){return enchant.Class.create(e,t)},enchant.Class.create=function(e,t){if(arguments.length===0)return enchant.Class.create(Object,t);if(arguments.length===1&&typeof arguments[0]!="function")return enchant.Class.create(Object,arguments[0]);for(var n in t)t.hasOwnProperty(n)&&(typeof t[n]=="object"&&Object.getPrototypeOf(t[n])===Object.prototype?"enumerable"in t[n]||(t[n].enumerable=!0):t[n]={value:t[n],enumerable:!0,writable:!0});var r=function(){if(!(this instanceof r))return new r;r.prototype.initialize.apply(this,arguments)};return r.prototype=Object.create(e.prototype,t),r.prototype.constructor=r,r.prototype.initialize==null&&(r.prototype.initialize=function(){e.apply(this,arguments)}),r},enchant.ENV={VENDOR_PREFIX:function(){var e=navigator.userAgent;return e.indexOf("Opera")!==-1?"O":e.indexOf("MSIE")!==-1?"ms":e.indexOf("WebKit")!==-1?"webkit":navigator.product==="Gecko"?"Moz":""}(),TOUCH_ENABLED:function(){var e=document.createElement("div");return e.setAttribute("ontouchstart","return"),typeof e.ontouchstart=="function"}(),RETINA_DISPLAY:function(){if(navigator.userAgent.indexOf("iPhone")!==-1&&window.devicePixelRatio===2){var e=document.querySelector('meta[name="viewport"]');return e==null&&(e=document.createElement("meta"),document.head.appendChild(e)),e.setAttribute("content","width=640"),!0}return!1}(),USE_FLASH_SOUND:function(){var e=navigator.userAgent,t=navigator.vendor||"";return location.href.indexOf("http")===0&&e.indexOf("Mobile")===-1&&t.indexOf("Apple")!==-1}(),USE_DEFAULT_EVENT_TAGS:["input","textarea","select","area"],CANVAS_DRAWING_METHODS:["putImageData","drawImage","drawFocusRing","fill","stroke","clearRect","fillRect","strokeRect","fillText","strokeText"]},enchant.Event=enchant.Class.create({initialize:function(e){this.type=e,this.target=null,this.x=0,this.y=0,this.localX=0,this.localY=0},_initPosition:function(e,t){var n=enchant.Game.instance;this.x=this.localX=(e-n._pageX)/n.scale,this.y=this.localY=(t-n._pageY)/n.scale}}),enchant.Event.LOAD="load",enchant.Event.PROGRESS="progress",enchant.Event.ENTER_FRAME="enterframe",enchant.Event.EXIT_FRAME="exitframe",enchant.Event.ENTER="enter",enchant.Event.EXIT="exit",enchant.Event.ADDED="added",enchant.Event.ADDED_TO_SCENE="addedtoscene",enchant.Event.REMOVED="removed",enchant.Event.REMOVED_FROM_SCENE="removedfromscene",enchant.Event.TOUCH_START="touchstart",enchant.Event.TOUCH_MOVE="touchmove",enchant.Event.TOUCH_END="touchend",enchant.Event.RENDER="render",enchant.Event.INPUT_START="inputstart",enchant.Event.INPUT_CHANGE="inputchange",enchant.Event.INPUT_END="inputend",enchant.Event.LEFT_BUTTON_DOWN="leftbuttondown",enchant.Event.LEFT_BUTTON_UP="leftbuttonup",enchant.Event.RIGHT_BUTTON_DOWN="rightbuttondown",enchant.Event.RIGHT_BUTTON_UP="rightbuttonup",enchant.Event.UP_BUTTON_DOWN="upbuttondown",enchant.Event.UP_BUTTON_UP="upbuttonup",enchant.Event.DOWN_BUTTON_DOWN="downbuttondown",enchant.Event.DOWN_BUTTON_UP="downbuttonup",enchant.Event.A_BUTTON_DOWN="abuttondown",enchant.Event.A_BUTTON_UP="abuttonup",enchant.Event.B_BUTTON_DOWN="bbuttondown",enchant.Event.B_BUTTON_UP="bbuttonup",enchant.EventTarget=enchant.Class.create({initialize:function(){this._listeners={}},addEventListener:function(e,t){var n=this._listeners[e];n==null?this._listeners[e]=[t]:n.indexOf(t)===-1&&n.unshift(t)},on:function(){this.addEventListener.apply(this,arguments)},removeEventListener:function(e,t){var n=this._listeners[e];if(n!=null){var r=n.indexOf(t);r!==-1&&n.splice(r,1)}},clearEventListener:function(e){e!=null?delete this._listeners[e]:this._listeners={}},dispatchEvent:function(e){e.target=this,e.localX=e.x-this._offsetX,e.localY=e.y-this._offsetY,this["on"+e.type]!=null&&this["on"+e.type](e);var t=this._listeners[e.type];if(t!=null){t=t.slice();for(var n=0,r=t.length;n<r;n++)t[n].call(this,e)}}}),function(){var e;enchant.Game=enchant.Class.create(enchant.EventTarget,{initialize:function(t,n){if(window.document.body===null)throw new Error("document.body is null. Please excute 'new Game()' in window.onload.");enchant.EventTarget.call(this);var r=!0;e&&(r=!1,e.stop()),e=enchant.Game.instance=this,this.width=t||320,this.height=n||320,this.scale=1;var i=document.getElementById("enchant-stage");if(!i)i=document.createElement("div"),i.id="enchant-stage",i.style.width=window.innerWidth+"px",i.style.height=window.innerHeight+"px",i.style.position="absolute",document.body.firstChild?document.body.insertBefore(i,document.body.firstChild):document.body.appendChild(i),this.scale=Math.min(window.innerWidth/this.width,window.innerHeight/this.height),this._pageX=0,this._pageY=0;else{var s=window.getComputedStyle(i);t=parseInt(s.width,10),n=parseInt(s.height,10),t&&n?this.scale=Math.min(t/this.width,n/this.height):(i.style.width=this.width+"px",i.style.height=this.height+"px");while(i.firstChild)i.removeChild(i.firstChild);i.style.position="relative";var o=i.getBoundingClientRect();this._pageX=Math.round(window.scrollX+o.left),this._pageY=Math.round(window.scrollY+o.top)}this.scale||(this.scale=1),i.style.fontSize="12px",i.style.webkitTextSizeAdjust="none",this._element=i,this.fps=30,this.frame=0,this.ready=null,this.running=!1,this.assets={};var u=this._assets=[];(function g(e){e.assets instanceof Array&&[].push.apply(u,e.assets);for(var t in e)e.hasOwnProperty(t)&&typeof e[t]=="object"&&Object.getPrototypeOf(e[t])===Object.prototype&&g(e[t])})(enchant),this._scenes=[],this.currentScene=null,this.rootScene=new enchant.Scene,this.pushScene(this.rootScene),this.loadingScene=new enchant.Scene,this.loadingScene.backgroundColor="#000";var a=this.width*.9|0,f=this.width*.3|0,l=a*.05|0,c=new enchant.Sprite(a,f);c.x=(this.width-a)/2,c.y=(this.height-f)/2;var h=new enchant.Surface(a,f);h.context.fillStyle="#fff",h.context.fillRect(0,0,a,f),h.context.fillStyle="#000",h.context.fillRect(l,l,a-l*2,f-l*2),c.image=h;var p=0,d=0;this.addEventListener("progress",function(e){p=e.loaded/e.total}),c.addEventListener("enterframe",function(){d*=.9,d+=p*.1,h.context.fillStyle="#fff",h.context.fillRect(l,0,(a-l*2)*d,f)}),this.loadingScene.addChild(c),this._mousedownID=0,this._surfaceID=0,this._soundID=0,this._intervalID=null,this._offsetX=0,this._offsetY=0,this.input={},this._keybind={},this.keybind(37,"left"),this.keybind(38,"up"),this.keybind(39,"right"),this.keybind(40,"down");var v=0;["left","right","up","down","a","b"].forEach(function(e){this.addEventListener(e+"buttondown",function(t){var n;this.input[e]||(this.input[e]=!0,n=new enchant.Event(v++?"inputchange":"inputstart"),this.dispatchEvent(n)),this.currentScene.dispatchEvent(t),n&&this.currentScene.dispatchEvent(n)}),this.addEventListener(e+"buttonup",function(t){var n;this.input[e]&&(this.input[e]=!1,n=new enchant.Event(--v?"inputchange":"inputend"),this.dispatchEvent(n)),this.currentScene.dispatchEvent(t),n&&this.currentScene.dispatchEvent(n)})},this);if(r){i=enchant.Game.instance._element;var m;document.addEventListener("keydown",function(t){e.dispatchEvent(new enchant.Event("keydown"));if(37<=t.keyCode&&t.keyCode<=40||t.keyCode===32)t.preventDefault(),t.stopPropagation();if(!e.running)return;var n=e._keybind[t.keyCode];n&&(m=new enchant.Event(n+"buttondown"),e.dispatchEvent(m))},!0),document.addEventListener("keyup",function(t){if(!e.running)return;var n=e._keybind[t.keyCode];n&&(m=new enchant.Event(n+"buttonup"),e.dispatchEvent(m))},!0),enchant.ENV.TOUCH_ENABLED?(i.addEventListener("touchstart",function(t){var n=t.target.tagName.toLowerCase();enchant.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(n)===-1&&(t.preventDefault(),e.running||t.stopPropagation())},!0),i.addEventListener("touchmove",function(t){var n=t.target.tagName.toLowerCase();enchant.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(n)===-1&&(t.preventDefault(),e.running||t.stopPropagation())},!0),i.addEventListener("touchend",function(t){var n=t.target.tagName.toLowerCase();enchant.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(n)===-1&&(t.preventDefault(),e.running||t.stopPropagation())},!0)):(i.addEventListener("mousedown",function(t){var n=t.target.tagName.toLowerCase();enchant.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(n)===-1&&(t.preventDefault(),e._mousedownID++,e.running||t.stopPropagation())},!0),i.addEventListener("mousemove",function(t){var n=t.target.tagName.toLowerCase();enchant.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(n)===-1&&(t.preventDefault(),e.running||t.stopPropagation())},!0),i.addEventListener("mouseup",function(t){var n=t.target.tagName.toLowerCase();enchant.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(n)===-1&&(t.preventDefault(),e.running||t.stopPropagation())},!0))}},preload:function(e){e instanceof Array||(e=Array.prototype.slice.call(arguments)),[].push.apply(this._assets,e)},load:function(t,n){n==null&&(n=function(){});var r=enchant.Game.findExt(t);if(enchant.Game._loadFuncs[r])enchant.Game._loadFuncs[r].call(this,t,n,r);else{var i=new XMLHttpRequest;i.open("GET",t,!0),i.onreadystatechange=function(r){if(i.readyState===4){if(i.status!==200&&i.status!==0)throw new Error(i.status+": "+"Cannot load an asset: "+t);var s=i.getResponseHeader("Content-Type")||"";s.match(/^image/)?(e.assets[t]=enchant.Surface.load(t),e.assets[t].addEventListener("load",n)):s.match(/^audio/)?(e.assets[t]=enchant.Sound.load(t,s),e.assets[t].addEventListener("load",n)):(e.assets[t]=i.responseText,n())}},i.send(null)}},start:function(){if(this._intervalID)window.clearInterval(this._intervalID);else if(this._assets.length){if(enchant.Sound.enabledInMobileSafari&&!e._touched&&enchant.ENV.VENDOR_PREFIX==="webkit"&&enchant.ENV.TOUCH_ENABLED){var t=new enchant.Scene;t.backgroundColor="#000";var n=Math.round(e.width/10),r=new enchant.Sprite(e.width,n);r.y=(e.height-n)/2,r.image=new enchant.Surface(e.width,n),r.image.context.fillStyle="#fff",r.image.context.font=n-1+"px bold Helvetica,Arial,sans-serif";var i=r.image.context.measureText("Touch to Start").width;r.image.context.fillText("Touch to Start",(e.width-i)/2,n-1),t.addChild(r),document.addEventListener("touchstart",function(){e._touched=!0,e.removeScene(t),e.start()},!0),e.pushScene(t);return}var s={},o=this._assets.filter(function(e){return e in s?!1:s[e]=!0}),u=0,a=o.length,f=function(){var t=new enchant.Event("progress");t.loaded=++u,t.total=a,e.dispatchEvent(t),u===a&&(e.removeScene(e.loadingScene),e.dispatchEvent(new enchant.Event("load")))};for(var l=0;l<a;l++)this.load(o[l],f);this.pushScene(this.loadingScene)}else this.dispatchEvent(new enchant.Event("load"));this.currentTime=Date.now(),this._intervalID=window.setInterval(function(){e._tick()},1e3/this.fps),this.running=!0},debug:function(){this._debug=!0,this.rootScene.addEventListener("enterframe",function(e){this._actualFps=1/e}),this.start()},actualFps:{get:function(){return this._actualFps||this.fps}},_tick:function(){var e=Date.now(),t=new enchant.Event("enterframe");t.elapsed=e-this.currentTime,this.currentTime=e;var n=this.currentScene.childNodes.slice(),r=Array.prototype.push;while(n.length){var i=n.pop();i.dispatchEvent(t),i.age++,i.childNodes&&r.apply(n,i.childNodes)}this.currentScene.age++,this.currentScene.dispatchEvent(t),this.dispatchEvent(t),this.dispatchEvent(new enchant.Event("exitframe")),this.frame++},stop:function(){this._intervalID&&(window.clearInterval(this._intervalID),this._intervalID=null),this.running=!1},pause:function(){this._intervalID&&(window.clearInterval(this._intervalID),this._intervalID=null)},resume:function(){if(this._intervalID)return;this.currentTime=Date.now(),this._intervalID=window.setInterval(function(){e._tick()},1e3/this.fps),this.running=!0},pushScene:function(e){return this._element.appendChild(e._element),this.currentScene&&this.currentScene.dispatchEvent(new enchant.Event("exit")),this.currentScene=e,this.currentScene.dispatchEvent(new enchant.Event("enter")),this._scenes.push(e)},popScene:function(){return this.currentScene===this.rootScene?this.currentScene:(this._element.removeChild(this.currentScene._element),this.currentScene.dispatchEvent(new enchant.Event("exit")),this.currentScene=this._scenes[this._scenes.length-2],this.currentScene.dispatchEvent(new enchant.Event("enter")),this._scenes.pop())},replaceScene:function(e){return this.popScene(),this.pushScene(e)},removeScene:function(e){if(this.currentScene===e)return this.popScene();var t=this._scenes.indexOf(e);return t!==-1?(this._scenes.splice(t,1),this._element.removeChild(e._element),e):null},keybind:function(e,t){this._keybind[e]=t},getElapsedTime:function(){return this.frame/this.fps}}),enchant.Game._loadFuncs={},enchant.Game._loadFuncs.jpg=enchant.Game._loadFuncs.jpeg=enchant.Game._loadFuncs.gif=enchant.Game._loadFuncs.png=enchant.Game._loadFuncs.bmp=function(e,t){this.assets[e]=enchant.Surface.load(e),this.assets[e].addEventListener("load",t)},enchant.Game._loadFuncs.mp3=enchant.Game._loadFuncs.aac=enchant.Game._loadFuncs.m4a=enchant.Game._loadFuncs.wav=enchant.Game._loadFuncs.ogg=function(e,t,n){this.assets[e]=enchant.Sound.load(e,"audio/"+n),this.assets[e].addEventListener("load",t)},enchant.Game.findExt=function(e){var t=e.match(/\.\w+$/);return t&&t.length>0?t[0].slice(1).toLowerCase():e.indexOf("data:")===0?e.split(/[\/;]/)[1].toLowerCase():null},enchant.Game.instance=null}(),enchant.Node=enchant.Class.create(enchant.EventTarget,{initialize:function(){enchant.EventTarget.call(this),this._x=0,this._y=0,this._offsetX=0,this._offsetY=0,this.age=0,this.parentNode=null,this.scene=null,this.addEventListener("touchstart",function(e){this.parentNode&&!this.parentNode._element&&this.parentNode.dispatchEvent(e)}),this.addEventListener("touchmove",function(e){this.parentNode&&!this.parentNode._element&&this.parentNode.dispatchEvent(e)}),this.addEventListener("touchend",function(e){this.parentNode&&!this.parentNode._element&&this.parentNode.dispatchEvent(e)})},moveTo:function(e,t){this._x=e,this._y=t,this._updateCoordinate()},moveBy:function(e,t){this._x+=e,this._y+=t,this._updateCoordinate()},x:{get:function(){return this._x},set:function(e){this._x=e,this._updateCoordinate()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._updateCoordinate()}},_updateCoordinate:function(){this.parentNode?(this._offsetX=this.parentNode._offsetX+this._x,this._offsetY=this.parentNode._offsetY+this._y):(this._offsetX=this._x,this._offsetY=this._y)},remove:function(){this._listener&&this.clearEventListener(),this.parentNode&&this.parentNode.removeChild(this)}}),enchant.Entity=enchant.Class.create(enchant.Node,{initialize:function(){var e=enchant.Game.instance;enchant.Node.call(this),this._element=document.createElement("div"),this._style=this._element.style,this._style.position="absolute",this._width=0,this._height=0,this._backgroundColor=null,this._opacity=1,this._visible=!0,this._buttonMode=null,enchant.Game.instance._debug&&(this._style.border="1px solid blue",this._style.margin="-1px"),this.buttonMode=null,this.buttonPressed=!1,this.addEventListener("touchstart",function(){if(!this.buttonMode)return;this.buttonPressed=!0;var t=new enchant.Event(this.buttonMode+"buttondown");this.dispatchEvent(t),e.dispatchEvent(t)}),this.addEventListener("touchend",function(){if(!this.buttonMode)return;this.buttonPressed=!1;var t=new enchant.Event(this.buttonMode+"buttonup");this.dispatchEvent(t),e.dispatchEvent(t)});var t=this,n=function(){t.dispatchEvent(new enchant.Event("render"))};this.addEventListener("addedtoscene",function(){n(),e.addEventListener("exitframe",n)}),this.addEventListener("removedfromscene",function(){e.removeEventListener("exitframe",n)}),this.addEventListener("render",function(){this._offsetX!==this._previousOffsetX&&(this._style.left=this._offsetX+"px"),this._offsetY!==this._previousOffsetY&&(this._style.top=this._offsetY+"px"),this._previousOffsetX=this._offsetX,this._previousOffsetY=this._offsetY}),enchant.ENV.TOUCH_ENABLED?(this._element.addEventListener("touchstart",function(e){var n=e.touches;for(var r=0,i=n.length;r<i;r++)e=new enchant.Event("touchstart"),e.identifier=n[r].identifier,e._initPosition(n[r].pageX,n[r].pageY),t.dispatchEvent(e)},!1),this._element.addEventListener("touchmove",function(e){var n=e.touches;for(var r=0,i=n.length;r<i;r++)e=new enchant.Event("touchmove"),e.identifier=n[r].identifier,e._initPosition(n[r].pageX,n[r].pageY),t.dispatchEvent(e)},!1),this._element.addEventListener("touchend",function(e){var n=e.changedTouches;for(var r=0,i=n.length;r<i;r++)e=new enchant.Event("touchend"),e.identifier=n[r].identifier,e._initPosition(n[r].pageX,n[r].pageY),t.dispatchEvent(e)},!1)):(this._element.addEventListener("mousedown",function(n){var r=n.pageX,i=n.pageY;n=new enchant.Event("touchstart"),n.identifier=e._mousedownID,n._initPosition(r,i),t.dispatchEvent(n),t._mousedown=!0},!1),e._element.addEventListener("mousemove",function(n){if(!t._mousedown)return;var r=n.pageX,i=n.pageY;n=new enchant.Event("touchmove"),n.identifier=e._mousedownID,n._initPosition(r,i),t.dispatchEvent(n)},!1),e._element.addEventListener("mouseup",function(n){if(!t._mousedown)return;var r=n.pageX,i=n.pageY;n=new enchant.Event("touchend"),n.identifier=e._mousedownID,n._initPosition(r,i),t.dispatchEvent(n),t._mousedown=!1},!1))},id:{get:function(){return this._element.id},set:function(e){this._element.id=e}},className:{get:function(){return this._element.className},set:function(e){this._element.className=e}},width:{get:function(){return this._width},set:function(e){this._style.width=(this._width=e)+"px"}},height:{get:function(){return this._height},set:function(e){this._style.height=(this._height=e)+"px"}},backgroundColor:{get:function(){return this._backgroundColor},set:function(e){this._element.style.backgroundColor=this._backgroundColor=e}},opacity:{get:function(){return this._opacity},set:function(e){this._style.opacity=this._opacity=e}},visible:{get:function(){return this._visible},set:function(e){(this._visible=e)?this._style.display="block":this._style.display="none"}},touchEnabled:{get:function(){return this._touchEnabled},set:function(e){(this._touchEnabled=e)?this._style.pointerEvents="all":this._style.pointerEvents="none"}},intersect:function(e){return this._offsetX<e._offsetX+e.width&&e._offsetX<this._offsetX+this.width&&this._offsetY<e._offsetY+e.height&&e._offsetY<this._offsetY+this.height},within:function(e,t){t==null&&(t=(this.width+this.height+e.width+e.height)/4);var n;return(n=this._offsetX-e._offsetX+(this.width-e.width)/2)*n+(n=this._offsetY-e._offsetY+(this.height-e.height)/2)*n<t*t},scale:function(e,t){t==null&&(t=e),this._scaleX*=e,this._scaleY*=t,this._dirty=!0},rotate:function(e){this._rotation+=e,this._dirty=!0},scaleX:{get:function(){return this._scaleX},set:function(e){this._scaleX=e,this._dirty=!0}},scaleY:{get:function(){return this._scaleY},set:function(e){this._scaleY=e,this._dirty=!0}},rotation:{get:function(){return this._rotation},set:function(e){this._rotation=e,this._dirty=!0}}}),enchant.Sprite=enchant.Class.create(enchant.Entity,{initialize:function(e,t){enchant.Entity.call(this),this.width=e,this.height=t,this._scaleX=1,this._scaleY=1,this._rotation=0,this._dirty=!1,this._image=null,this._frame=0,this._frameSequence=[],this._style.overflow="hidden",this.addEventListener("render",function(){if(this._dirty){var e=["rotate(",this._rotation,"deg)","scale(",this._scaleX,",",this._scaleY,")"];navigator.userAgent.indexOf("iPhone")!==-1&&e.push("translate3d(0,0,0)"),this._style[enchant.ENV.VENDOR_PREFIX+"Transform"]=e.join(""),this._dirty=!1}}),this.addEventListener("enterframe",function(){if(this._frameSequence.length!==0){var e=this._frameSequence.shift();e===null?this._frameSequence=[]:(this._setFrame(e),this._frameSequence.push(e))}}),enchant.Game.instance._debug&&(this._style.border="1px solid red",this._style.margin="-1px")},image:{get:function(){return this._image},set:function(e){if(e===this._image)return;this._image!=null&&(this._image.css?this._style.backgroundImage="":this._element.firstChild&&(this._element.removeChild(this._element.firstChild),this._dirtyListener?(this.removeEventListener("render",this._dirtyListener),this._dirtyListener=null):this._image._parent=null));if(e!=null)if(e._css)this._style.backgroundImage=e._css;else if(e._parent){var t=document.createElement("canvas"),n=t.getContext("2d");t.width=e.width,t.height=e.height,n.drawImage(e._element,0,0),this._dirtyListener=function(){e._dirty&&(n.drawImage(e._element),e._dirty=!1)},this.addEventListener("render",this._dirtyListener),this._element.appendChild(t)}else e._parent=this,this._element.appendChild(e._element);this._image=e,this.frame=this.frame}},frame:{get:function(){return this._frame},set:function(e){if(e instanceof Array){var t=e,n=t.shift();this._setFrame(n),t.push(n),this._frameSequence=t}else this._setFrame(e),this._frameSequence=[],this._frame=e}},_setFrame:function(e){if(this._image!=null){this._frame=e;var t=this._image.width/this._width|0;if(this._image._css)this._style.backgroundPosition=[-(e%t|0)*this._width,"px ",-(e/t|0)*this._height,"px"].join("");else if(this._element.firstChild){var n=this._element.firstChild.style;n.left=-(e%t|0)*this._width+"px",n.top=-(e/t|0)*this._height+"px"}}}}),enchant.Label=enchant.Class.create(enchant.Entity,{initialize:function(e){enchant.Entity.call(this),this.width=300,this.text=e,this.textAlign="left"},text:{get:function(){return this._element.innerHTML},set:function(e){this._element.innerHTML=e}},textAlign:{get:function(){return this._style.textAlign},set:function(e){this._style.textAlign=e}},font:{get:function(){return this._style.font},set:function(e){this._style.font=e}},color:{get:function(){return this._style.color},set:function(e){this._style.color=e}}}),function(){enchant.Map=enchant.Class.create(enchant.Entity,{initialize:function(e,t){var n=enchant.Game.instance;enchant.Entity.call(this);var r=document.createElement("canvas");enchant.ENV.RETINA_DISPLAY&&n.scale===2?(r.width=n.width*2,r.height=n.height*2,this._style.webkitTransformOrigin="0 0",this._style.webkitTransform="scale(0.5)"):(r.width=n.width,r.height=n.height),this._element.appendChild(r),this._context=r.getContext("2d"),this._tileWidth=e||0,this._tileHeight=t||0,this._image=null,this._data=[[[]]],this._dirty=!1,this._tight=!1,this.touchEnabled=!1,this.collisionData=null,this._listeners.render=null,this.addEventListener("render",function(){if(this._dirty||this._previousOffsetX==null)this._dirty=!1,this.redraw(0,0,n.width,n.height);else if(this._offsetX!==this._previousOffsetX||this._offsetY!==this._previousOffsetY)if(this._tight){var e=-this._offsetX,t=-this._offsetY,r=-this._previousOffsetX,i=-this._previousOffsetY,s=e-r+n.width,o=r-e+n.width,u=t-i+n.height,a=i-t+n.height;if(s>this._tileWidth&&o>this._tileWidth&&u>this._tileHeight&&a>this._tileHeight){var f,l,c,h,p,d;s<o?(f=0,c=r-e,p=s):(f=e-r,c=0,p=o),u<a?(l=0,h=i-t,d=u):(l=t-i,h=0,d=a),n._buffer==null&&(n._buffer=document.createElement("canvas"),n._buffer.width=this._context.canvas.width,n._buffer.height=this._context.canvas.height);var v=n._buffer.getContext("2d");this._doubledImage?(v.clearRect(0,0,p*2,d*2),v.drawImage(this._context.canvas,f*2,l*2,p*2,d*2,0,0,p*2,d*2),v=this._context,v.clearRect(c*2,h*2,p*2,d*2),v.drawImage(n._buffer,0,0,p*2,d*2,c*2,h*2,p*2,d*2)):(v.clearRect(0,0,p,d),v.drawImage(this._context.canvas,f,l,p,d,0,0,p,d),v=this._context,v.clearRect(c,h,p,d),v.drawImage(n._buffer,0,0,p,d,c,h,p,d)),c===0?this.redraw(p,0,n.width-p,n.height):this.redraw(0,0,n.width-p,n.height),h===0?this.redraw(0,d,n.width,n.height-d):this.redraw(0,0,n.width,n.height-d)}else this.redraw(0,0,n.width,n.height)}else this.redraw(0,0,n.width,n.height);this._previousOffsetX=this._offsetX,this._previousOffsetY=this._offsetY})},loadData:function(e){this._data=Array.prototype.slice.apply(arguments),this._dirty=!0,this._tight=!1;for(var t=0,n=this._data.length;t<n;t++){var r=0;e=this._data[t];for(var i=0,s=e.length;i<s;i++)for(var o=0,u=e[i].length;o<u;o++)e[i][o]>=0&&r++;if(r/(e.length*e[0].length)>.2){this._tight=!0;break}}},checkTile:function(e,t){if(e<0||this.width<=e||t<0||this.height<=t)return!1;var n=this._image.width,r=this._image.height,i=this._tileWidth||n,s=this._tileHeight||r;e=e/i|0,t=t/s|0;var o=this._data[0];return o[t][e]},hitTest:function(e,t){if(e<0||this.width<=e||t<0||this.height<=t)return!1;var n=this._image.width,r=this._image.height,i=this._tileWidth||n,s=this._tileHeight||r;e=e/i|0,t=t/s|0;if(this.collisionData!=null)return this.collisionData[t]&&!!this.collisionData[t][e];for(var o=0,u=this._data.length;o<u;o++){var a=this._data[o],f;if(a[t]!=null&&(f=a[t][e])!=null&&0<=f&&f<(n/i|0)*(r/s|0))return!0}return!1},image:{get:function(){return this._image},set:function(e){var t=enchant.Game.instance;this._image=e;if(enchant.ENV.RETINA_DISPLAY&&t.scale===2){var n=new enchant.Surface(e.width*2,e.height*2),r=this._tileWidth||e.width,i=this._tileHeight||e.height,s=e.width/r|0,o=e.height/i|0;for(var u=0;u<o;u++)for(var a=0;a<s;a++)n.draw(e,a*r,u*i,r,i,a*r*2,u*i*2,r*2,i*2);this._doubledImage=n}this._dirty=!0}},tileWidth:{get:function(){return this._tileWidth},set:function(e){this._tileWidth=e,this._dirty=!0}},tileHeight:{get:function(){return this._tileHeight},set:function(e){this._tileHeight=e,this._dirty=!0}},width:{get:function(){return this._tileWidth*this._data[0][0].length}},height:{get:function(){return this._tileHeight*this._data[0].length}},redraw:function(e,t,n,r){if(this._image==null)return;var i,s,o,u,a;this._doubledImage?(i=this._doubledImage,s=this._tileWidth*2,o=this._tileHeight*2,u=-this._offsetX*2,a=-this._offsetY*2,e*=2,t*=2,n*=2,r*=2):(i=this._image,s=this._tileWidth,o=this._tileHeight,u=-this._offsetX,a=-this._offsetY);var f=i.width/s|0,l=i.height/o|0,c=Math.max((e+u)/s|0,0),h=Math.max((t+a)/o|0,0),p=Math.ceil((e+u+n)/s),d=Math.ceil((t+a+r)/o),v=i._element,m=this._context,g=m.canvas;m.clearRect(e,t,n,r);for(var y=0,b=this._data.length;y<b;y++){var w=this._data[y],E=Math.min(p,w[0].length),S=Math.min(d,w.length);for(t=h;t<S;t++)for(e=c;e<E;e++){var x=w[t][e];if(0<=x&&x<f*l){var T=x%f*s,N=(x/f|0)*o;m.drawImage(v,T,N,s,o,e*s-u,t*o-a,s,o)}}}}})}(),enchant.Group=enchant.Class.create(enchant.Node,{initialize:function(){enchant.Node.call(this),this.childNodes=[],this._x=0,this._y=0},addChild:function(e){this.childNodes.push(e),e.parentNode=this,e.dispatchEvent(new enchant.Event("added"));if(this.scene){var t=new enchant.Event("addedtoscene");e.scene=this.scene,e.dispatchEvent(t),e._updateCoordinate();var n=document.createDocumentFragment(),r,i=Array.prototype.push;if(e._element)n.appendChild(e._element);else if(e.childNodes){r=e.childNodes.slice().reverse();while(r.length)e=r.pop(),e.scene=this.scene,e.dispatchEvent(t),e._element?n.appendChild(e._element):e.childNodes&&i.apply(r,e.childNodes.reverse())}if(!n.childNodes.length)return;var s,o=this;while(o.parentNode){r=o.parentNode.childNodes,r=r.slice(r.indexOf(o)+1).reverse();while(r.length){e=r.pop();if(e._element){s=e._element;break}e.childNodes&&i.apply(r,e.childNodes.slice().reverse())}o=o.parentNode}s?this.scene._element.insertBefore(n,s):this.scene._element.appendChild(n)}},insertBefore:function(e,t){var n=this.childNodes.indexOf(t);if(n!==-1){this.childNodes.splice(n,0,e),e.parentNode=this,e.dispatchEvent(new enchant.Event("added"));if(this.scene){var r=new enchant.Event("addedtoscene");e.scene=this.scene,e.dispatchEvent(r),e._updateCoordinate();var i=document.createDocumentFragment(),s,o=Array.prototype.push;if(e._element)i.appendChild(e._element);else if(e.childNodes){s=e.childNodes.slice().reverse();while(s.length)e=s.pop(),e.scene=this.scene,e.dispatchEvent(r),e._element?i.appendChild(e._element):e.childNodes&&o.apply(s,e.childNodes.reverse())}if(!i.childNodes.length)return;var u,a=t;while(a!==this){n!=null?(s=this.childNodes.slice(n+1).reverse(),n=null):(s=a.parentNode.childNodes,s=s.slice(s.indexOf(a)+1).reverse());while(s.length){e=s.pop();if(e._element){u=e._element;break}e.childNodes&&o.apply(s,e.childNodes.slice().reverse())}a=a.parentNode}u?this.scene._element.insertBefore(i,u):this.scene._element.appendChild(i)}}else this.addChild(e)},removeChild:function(e){var t=this.childNodes.indexOf(e);if(t===-1)return;this.childNodes.splice(t,1),e.parentNode=null,e.dispatchEvent(new enchant.Event("removed"));if(this.scene){var n=new enchant.Event("removedfromscene");e.scene=null,e.dispatchEvent(n);if(e._element)this.scene._element.removeChild(e._element);else if(e.childNodes){var r=e.childNodes.slice(),i=Array.prototype.push;while(r.length)e=r.pop(),e.scene=null,e.dispatchEvent(n),e._element?this.scene._element.removeChild(e._element):e.childNodes&&i.apply(r,e.childNodes)}}},firstChild:{get:function(){return this.childNodes[0]}},lastChild:{get:function(){return this.childNodes[this.childNodes.length-1]}},_updateCoordinate:function(){this.parentNode?(this._offsetX=this.parentNode._offsetX+this._x,this._offsetY=this.parentNode._offsetY+this._y):(this._offsetX=this._x,this._offsetY=this._y);for(var e=0,t=this.childNodes.length;e<t;e++)this.childNodes[e]._updateCoordinate()}}),enchant.RGroup=enchant.Class.create(enchant.Group,{initialize:function(e,t){enchant.Group.call(this);if(arguments.length<2)throw"Width and height of RGroup must be specified";this.width=e,this.height=t,this.rotationOrigin={x:e/2,y:t/2},this._rotation=0},addChild:function(e){enchant.Group.prototype.addChild.apply(this,arguments),e.transformOrigin="0 0"},rotation:{get:function(){return this._rotation},set:function(e){var t=e-this._rotation;if(t===0)return;var n=t/180*Math.PI,r=Math.sin(n),i=Math.cos(n),s={x:this.width/2,y:this.height/2};for(var o=0,u=this.childNodes.length;o<u;o++){var a=this.childNodes[o];a.rotation-=t;var f=a.x-s.x,l=a.y-s.y;a.x=+i*f+r*l+s.x,a.y=-r*f+i*l+s.y}this._rotation=e}}}),enchant.Scene=enchant.Class.create(enchant.Group,{initialize:function(){var e=enchant.Game.instance;enchant.Group.call(this),this._element=document.createElement("div"),this._element.style.position="absolute",this._element.style.overflow="hidden",this._element.style.width=(this.width=e.width)+"px",this._element.style.height=(this.height=e.height)+"px",this._element.style[enchant.ENV.VENDOR_PREFIX+"TransformOrigin"]="0 0",this._element.style[enchant.ENV.VENDOR_PREFIX+"Transform"]="scale("+e.scale+")",this.scene=this;var t=this;enchant.ENV.TOUCH_ENABLED?(this._element.addEventListener("touchstart",function(e){var n=e.touches;for(var r=0,i=n.length;r<i;r++)e=new enchant.Event("touchstart"),e.identifier=n[r].identifier,e._initPosition(n[r].pageX,n[r].pageY),t.dispatchEvent(e)},!1),this._element.addEventListener("touchmove",function(e){var n=e.touches;for(var r=0,i=n.length;r<i;r++)e=new enchant.Event("touchmove"),e.identifier=n[r].identifier,e._initPosition(n[r].pageX,n[r].pageY),t.dispatchEvent(e)},!1),this._element.addEventListener("touchend",function(e){var n=e.changedTouches;for(var r=0,i=n.length;r<i;r++)e=new enchant.Event("touchend"),e.identifier=n[r].identifier,e._initPosition(n[r].pageX,n[r].pageY),t.dispatchEvent(e)},!1)):(this._element.addEventListener("mousedown",function(n){var r=n.pageX,i=n.pageY;n=new enchant.Event("touchstart"),n.identifier=e._mousedownID,n._initPosition(r,i),t.dispatchEvent(n),t._mousedown=!0},!1),e._element.addEventListener("mousemove",function(n){if(!t._mousedown)return;var r=n.pageX,i=n.pageY;n=new enchant.Event("touchmove"),n.identifier=e._mousedownID,n._initPosition(r,i),t.dispatchEvent(n)},!1),e._element.addEventListener("mouseup",function(n){if(!t._mousedown)return;var r=n.pageX,i=n.pageY;n=new enchant.Event("touchend"),n.identifier=e._mousedownID,n._initPosition(r,i),t.dispatchEvent(n),t._mousedown=!1},!1))},backgroundColor:{get:function(){return this._backgroundColor},set:function(e){this._element.style.backgroundColor=this._backgroundColor=e}},_updateCoordinate:function(){this._offsetX=this._x,this._offsetY=this._y;for(var e=0,t=this.childNodes.length;e<t;e++)this.childNodes[e]._updateCoordinate()}}),function(){enchant.CanvasGroup=enchant.Class.create(enchant.Group,{initialize:function(){var e=enchant.Game.instance,n=this;enchant.Group.call(this),this._dirty=!1,this._rotation=0,this._cvsCache={},this._cvsCache.matrix=[1,0,0,1,0,0],this._cvsCache.detectColor="#000000",this.width=e.width,this.height=e.height;var r=[enchant.Event.ADDED_TO_SCENE,enchant.Event.REMOVED_FROM_SCENE];r.forEach(function(e){this.addEventListener(e,function(e){this.childNodes.forEach(function(t){t.scene=this.scene,t.dispatchEvent(e)},this)})},this),this._element=document.createElement("canvas"),this._element.width=e.width,this._element.height=e.height,this._element.style.position="absolute",this._detect=document.createElement("canvas"),this._detect.width=e.width,this._detect.height=e.height,this._detect.style.position="absolute",this.context=this._element.getContext("2d"),this._dctx=this._detect.getContext("2d"),this._colorManager=new u(16,256),enchant.ENV.TOUCH_ENABLED?(this._element.addEventListener("touchstart",function(e){var t=e.touches;for(var r=0,s=t.length;r<s;r++)e=new enchant.Event("touchstart"),e.identifier=t[r].identifier,e._initPosition(t[r].pageX,t[r].pageY),i.call(n,e)},!1),this._element.addEventListener("touchmove",function(e){var t=e.touches;for(var r=0,i=t.length;r<i;r++)e=new enchant.Event("touchmove"),e.identifier=t[r].identifier,e._initPosition(t[r].pageX,t[r].pageY),s.call(n,e)},!1),this._element.addEventListener("touchend",function(e){var t=e.changedTouches;for(var r=0,i=t.length;r<i;r++)e=new enchant.Event("touchend"),e.identifier=t[r].identifier,e._initPosition(t[r].pageX,t[r].pageY),o.call(n,e)},!1)):(this._element.addEventListener("mousedown",function(t){var r=t.pageX,s=t.pageY;t=new enchant.Event("touchstart"),t.identifier=e._mousedownID,t._initPosition(r,s),i.call(n,t),n._mousedown=!0},!1),e._element.addEventListener("mousemove",function(t){if(!n._mousedown)return;var r=t.pageX,i=t.pageY;t=new enchant.Event("touchmove"),t.identifier=e._mousedownID,t._initPosition(r,i),s.call(n,t)},!1),e._element.addEventListener("mouseup",function(t){if(!n._mousedown)return;var r=t.pageX,i=t.pageY;t=new enchant.Event("touchend"),t.identifier=e._mousedownID,t._initPosition(r,i),o.call(n,t),n._mousedown=!1},!1));var a=[enchant.Event.ENTER,enchant.Event.ADDED_TO_SCENE],f=[enchant.Event.EXIT,enchant.Event.REMOVED_FROM_SCENE];a.forEach(function(e){this.addEventListener(e,this._startRendering),this.addEventListener(e,function(){t.push(this)})},this),f.forEach(function(e){this.addEventListener(e,this._stopRendering),this.addEventListener(e,function(){var e=t.indexOf(this);e!==-1&&t.splice(e,1)})},this),this._onexitframe=function(){var t=n.context;t.clearRect(0,0,e.width,e.height),E.call(n,n._colorManager),d.call(n,t)}},_startRendering:function(){var e=enchant.Game.instance;e._listeners.exitframe||(e._listeners.exitframe=[]),e._listeners.exitframe.push(this._onexitframe)},_stopRendering:function(){var e=enchant.Game.instance;e.removeEventListener("exitframe",this._onexitframe)},_getEntityByPosition:function(e,t){var n=this._dctx;n.clearRect(0,0,this.width,this.height),g.call(this,n);var r=n.getImageData(e,t,1,1).data;return this._colorManager.getSpriteByColor(r)},_touchstartPropagation:function(e){var t=this._getEntityByPosition(e.x,e.y);return t?(this._touching=t,N.call(this._touching,e,this.parentNode)):t=null,t},_touchmovePropagation:function(e){this._touching!=null&&N.call(this._touching,e,this.parentNode)},_touchendPropagation:function(e){this._touching!=null&&(N.call(this._touching,e,this.parentNode),this._touching=null)},rotation:{get:function(){return this._rotation},set:function(e){this._rotation=e,this._dirty=!0}},scaleX:{get:function(){return this._scaleX},set:function(e){this._scaleX=e,this._dirty=!0}},scaleY:{get:function(){return this._scaleY},set:function(e){this._scaleY=e,this._dirty=!0}},addChild:function(e){this.childNodes.push(e),e.parentNode=this,e.dispatchEvent(new enchant.Event("added"));if(this.scene){e.scene=this.scene;var t=new enchant.Event("addedtoscene");S.call(e,t,this._colorManager)}},insertBefore:function(e,t){var n=this.childNodes.indexOf(t);if(n!==-1){this.childNodes.splice(n,0,e),e.dispatchEvent(new enchant.Event("added"));if(this.scene){e.scene=this.scene;var r=new enchant.Event("addedtoscene");S.call(e,r,this._colorManager)}}else this.addChild(e)},removeChild:function(e){var t;(t=this.childNodes.indexOf(e))!==-1&&this.childNodes.splice(t,1),e.parentNode=null,e.dispatchEvent(new enchant.Event("removed"));if(this.scene){e.scene=null;var n=new enchant.Event("removedfromscene");x.call(e,n,this._colorManager)}}});var e=0,t=[],n=null,r=null,i=function(e){var i=enchant.Game.instance,s;for(var o=t.length-1;o>=0;o--){s=t[o];if(s.scene!==i.currentScene)continue;var u=s._touchstartPropagation(e);if(u){n=u,r=s;return}}},s=function(e){r!=null&&r._touchmovePropagation(e)},o=function(e){r!=null&&(r._touchendPropagation(e),n=null,r=null)};enchant.widget&&(enchant.widget.EntityGroup.prototype.cvsRender=function(t){this.background&&this.background._element.width>0&&this.background._element.height>0&&t.drawImage(this.background._element,e,e,this.width+e,this.height+e),t.beginPath(),t.rect(0,0,this.width,this.height),t.clip()}),enchant.Map.prototype.cvsRender=function(e){var t=enchant.Game.instance;e.save(),e.setTransform(1,0,0,1,0,0);var n=this._element.firstChild;e.drawImage(n,0,0,t.width,t.height),e.restore()},enchant.Sprite.prototype.cvsRender=function(t){var n,r,i,s,o,u,a,f;this._image&&(s=Math.abs(this._frame)||0,n=this._image,r=n._element,i=n.width/this._width|0,o=(s%i|0)*this._width,u=(s/i|0)*this._height%n.height,u=Math.min(u,n.height-this._height),a=Math.min(n.width-o,this._width),f=Math.min(n.height-u,this._height),t.drawImage(r,o,u,a,f,e,e,this._width+e,this._height+e))},enchant.Label.prototype.cvsRender=function(t){this.text&&(t.textBaseline="top",t.font=this.font,t.fillStyle=this.color||"#000000",t.fillText(this.text,e,e,this.width+e))};var u=enchant.Class.create({initialize:function(e,t){this.reference=[],this.detectColorNum=0,this.colorResolution=e||16,this.max=t||1},attachDetectColor:function(e){return this.detectColorNum+=1,this.reference[this.detectColorNum]=e,this._createNewColor()},detachDetectColor:function(e){var t=this.reference.indexOf(e);t!==-1&&(this.reference[t]=null)},_createNewColor:function(){var e=this.detectColorNum,t=this.colorResolution,n=t/this.max;return[parseInt(e/t/t%t,10)/n,parseInt(e/t%t,10)/n,parseInt(e%t,10)/n,1]},_decodeDetectColor:function(e){var t=this.colorResolution;return~~(e[0]*t*t*t/256)+~~(e[1]*t*t/256)+~~(e[2]*t/256)},getSpriteByColor:function(e){return this.reference[this._decodeDetectColor(e)]}}),a=function(e,t){e=e||function(){},t=t||function(){};var n=function(){e.apply(this,arguments);var r;if(this.childNodes)for(var i=0,s=this.childNodes.length;i<s;i++)r=this.childNodes[i],n.apply(r,arguments);t.apply(this,arguments)};return n},f=function(e,t){var n=e.x,r=e.y,i=e.width||0,s=e.height||0,o=e.rotation||0,u=typeof e.scaleX=="number"?e.scaleX:1,a=typeof e.scaleY=="number"?e.scaleY:1,f=Math.PI*o/180,l=Math.cos(f),c=Math.sin(f),h=typeof e.originX=="number"?e.originX:i/2,p=typeof e.originY=="number"?e.originY:s/2,d=u*l,v=u*c,m=a*c,g=a*l;t[0]=u*l,t[1]=u*c,t[2]=-a*c,t[3]=a*l,t[4]=-d*h+m*p+n+h,t[5]=-v*h-g*p+r+p},l=function(e){if(e.__dirty||e._cvsCache.x!==e.x||e._cvsCache.y!==e.y||e._cvsCache.width!==e.width||e._cvsCache.height!==e.height)f(e,e._cvsCache.matrix),e.__dirty=!1,e._cvsCache.x=e.x,e._cvsCache.y=e.y,e._cvsCache.width=e.width,e._cvsCache.height=e.height},c=function(e,t){t.alphaBlending?e.globalCompositeOperation=t.alphaBlending:e.globalCompositeOperation="source-atob",e.globalAlpha=t.opacity||1},h=function(e,t){l(t),e.transform.apply(e,t._cvsCache.matrix)},p=function(t,n){var r=enchant.Game.instance;n.backgroundColor&&(t.fillStyle=n.backgroundColor,t.fillRect(e,e,n.width+e,n.height+e)),n.cvsRender&&n.cvsRender(t),r._debug&&(n instanceof enchant.Label||n instanceof enchant.Sprite?t.strokeStyle="#ff0000":t.strokeStyle="#0000ff",t.strokeRect(e,e,n.width+e,n.height+e))},d=a(function(e){e.save(),c(e,this),h(e,this),p(e,this)},function(e){e.restore()}),v=function(e){return"#"+("00"+Number(parseInt(e[0],10)).toString(16)).slice(-2)+("00"+Number(parseInt(e[1],10)).toString(16)).slice(-2)+("00"+Number(parseInt(e[2],10)).toString(16)).slice(-2)},m=function(e,t){e.fillStyle=t._cvsCache.detectColor,e.fillRect(0,0,t.width,t.height)},g=a(function(e){e.save(),h(e,this),m(e,this)},function(e){e.restore()}),y=function(){this._dirty?this.__dirty=!0:this.__dirty=!1},b=function(e){if(this._cvsCache)return;this.addEventListener("render",y),this._cvsCache={},this._cvsCache.matrix=[],this._cvsCache.detectColor=v(e.attachDetectColor(this))},w=function(e){if(!this._cvsCache)return;this.removeEventListener("render",y),e.detachDetectColor(this),delete this._cvsCache},E=a(function(e){b.call(this,e)}),S=a(function(e,t){this.dispatchEvent(e),b.call(this,t)}),x=a(function(e,t){this.dispatchEvent(e),w.call(this,t)}),T=a(function(e){this.dispatchEvent(e)}),N=function(e,t){this.dispatchEvent(e),this.parentNode&&this.parentNode!==t&&N.call(this.parentNode,e,t)}}(),enchant.Scene=enchant.Class.create(enchant.Group,{initialize:function(){enchant.Group.call(this),this._element=document.createElement("div"),this._element.style.position="absolute",this._element.style.overflow="hidden",this._element.style.width=(this.width=enchant.Game.instance.width)+"px",this._element.style.height=(this.height=enchant.Game.instance.height)+"px",this._element.style[enchant.ENV.VENDOR_PREFIX+"TransformOrigin"]="0 0",this._element.style[enchant.ENV.VENDOR_PREFIX+"Transform"]="scale("+enchant.Game.instance.scale+")",this.scene=this;var e=this;enchant.ENV.TOUCH_ENABLED?(this._element.addEventListener("touchstart",function(t){var n=t.touches;for(var r=0,i=n.length;r<i;r++)t=new enchant.Event("touchstart"),t.identifier=n[r].identifier,t._initPosition(n[r].pageX,n[r].pageY),e.dispatchEvent(t)},!1),this._element.addEventListener("touchmove",function(t){var n=t.touches;for(var r=0,i=n.length;r<i;r++)t=new enchant.Event("touchmove"),t.identifier=n[r].identifier,t._initPosition(n[r].pageX,n[r].pageY),e.dispatchEvent(t)},!1),this._element.addEventListener("touchend",function(t){var n=t.changedTouches;for(var r=0,i=n.length;r<i;r++)t=new enchant.Event("touchend"),t.identifier=n[r].identifier,t._initPosition(n[r].pageX,n[r].pageY),e.dispatchEvent(t)},!1)):(this._element.addEventListener("mousedown",function(t){var n=t.pageX,r=t.pageY;t=new enchant.Event("touchstart"),t.identifier=enchant.Game.instance._mousedownID,t._initPosition(n,r),e.dispatchEvent(t),e._mousedown=!0},!1),enchant.Game.instance._element.addEventListener("mousemove",function(t){if(!e._mousedown)return;var n=t.pageX,r=t.pageY;t=new enchant.Event("touchmove"),t.identifier=enchant.Game.instance._mousedownID,t._initPosition(n,r),e.dispatchEvent(t)},!1),enchant.Game.instance._element.addEventListener("mouseup",function(t){if(!e._mousedown)return;var n=t.pageX,r=t.pageY;t=new enchant.Event("touchend"),t.identifier=enchant.Game.instance._mousedownID,t._initPosition(n,r),e.dispatchEvent(t),e._mousedown=!1},!1))},backgroundColor:{get:function(){return this._backgroundColor},set:function(e){this._element.style.backgroundColor=this._backgroundColor=e}},_updateCoordinate:function(){this._offsetX=this._x,this._offsetY=this._y;for(var e=0,t=this.childNodes.length;e<t;e++)this.childNodes[e]._updateCoordinate()}}),enchant.Surface=enchant.Class.create(enchant.EventTarget,{initialize:function(e,t){enchant.EventTarget.call(this);var n=enchant.Game.instance;this.width=e,this.height=t,this.context=null;var r="enchant-surface"+n._surfaceID++;if(document.getCSSCanvasContext){this.context=document.getCSSCanvasContext("2d",r,e,t),this._element=this.context.canvas,this._css="-webkit-canvas("+r+")";var i=this.context}else document.mozSetImageElement?(this._element=document.createElement("canvas"),this._element.width=e,this._element.height=t,this._css="-moz-element(#"+r+")",this.context=this._element.getContext("2d"),document.mozSetImageElement(r,this._element)):(this._element=document.createElement("canvas"),this._element.width=e,this._element.height=t,this._element.style.position="absolute",this.context=this._element.getContext("2d"),enchant.ENV.CANVAS_DRAWING_METHODS.forEach(function(e){var t=this.context[e];this.context[e]=function(){t.apply(this,arguments),this._dirty=!0}},this))},getPixel:function(e,t){return this.context.getImageData(e,t,1,1).data},setPixel:function(e,t,n,r,i,s){var o=this.context.createImageData(1,1);o.data[0]=n,o.data[1]=r,o.data[2]=i,o.data[3]=s,this.context.putImageData(o,e,t)},clear:function(){this.context.clearRect(0,0,this.width,this.height)},draw:function(e){e=e._element;if(arguments.length===1)this.context.drawImage(e,0,0);else{var t=arguments;t[0]=e,this.context.drawImage.apply(this.context,t)}},clone:function(){var e=new enchant.Surface(this.width,this.height);return e.draw(this),e},toDataURL:function(){var e=this._element.src;return e?e.slice(0,5)==="data:"?e:this.clone().toDataURL():this._element.toDataURL()}}),enchant.Surface.load=function(e){var t=new Image,n=Object.create(enchant.Surface.prototype,{context:{value:null},_css:{value:"url("+e+")"},_element:{value:t}});return enchant.EventTarget.call(n),t.src=e,t.onerror=function(){throw new Error("Cannot load an asset: "+t.src)},t.onload=function(){n.width=t.width,n.height=t.height,n.dispatchEvent(new enchant.Event("load"))},n},enchant.Sound=enchant.Class.create(enchant.EventTarget,{initialize:function(){throw enchant.EventTarget.call(this),this.duration=0,new Error("Illegal Constructor")},play:function(){this._element&&this._element.play()},pause:function(){this._element&&this._element.pause()},stop:function(){this.pause(),this.currentTime=0},clone:function(){var e;if(this._element instanceof Audio)e=Object.create(enchant.Sound.prototype,{_element:{value:this._element.cloneNode(!1)},duration:{value:this.duration}});else{if(enchant.ENV.USE_FLASH_SOUND)return this;e=Object.create(enchant.Sound.prototype)}return enchant.EventTarget.call(e),e},currentTime:{get:function(){return this._element?this._element.currentTime:0},set:function(e){this._element&&(this._element.currentTime=e)}},volume:{get:function(){return this._element?this._element.volume:1},set:function(e){this._element&&(this._element.volume=e)}}}),enchant.Sound.load=function(e,t){if(t==null){var n=enchant.Game.findExt(e);n?t="audio/"+n:t=""}t=t.replace("mp3","mpeg").replace("m4a","mp4");var r=Object.create(enchant.Sound.prototype);enchant.EventTarget.call(r);var i=new Audio;if(!enchant.Sound.enabledInMobileSafari&&enchant.ENV.VENDOR_PREFIX==="webkit"&&enchant.ENV.TOUCH_ENABLED)window.setTimeout(function(){r.dispatchEvent(new enchant.Event("load"))},0);else if(!enchant.ENV.USE_FLASH_SOUND&&i.canPlayType(t))i.src=e,i.load(),i.autoplay=!1,i.onerror=function(){throw new Error("Cannot load an asset: "+i.src)},i.addEventListener("canplaythrough",function(){r.duration=i.duration,r.dispatchEvent(new enchant.Event("load"))},!1),r._element=i;else if(t==="audio/mpeg"){var s=document.createElement("embed"),o="enchant-audio"+enchant.Game.instance._soundID++;s.width=s.height=1,s.name=o,s.src="sound.swf?id="+o+"&src="+e,s.allowscriptaccess="always",s.style.position="absolute",s.style.left="-1px",r.addEventListener("load",function(){Object.defineProperties(s,{currentTime:{get:function(){return s.getCurrentTime()},set:function(e){s.setCurrentTime(e)}},volume:{get:function(){return s.getVolume()},set:function(e){s.setVolume(e)}}}),r._element=s,r.duration=s.getDuration()}),enchant.Game.instance._element.appendChild(s),enchant.Sound[o]=r}else window.setTimeout(function(){r.dispatchEvent(new enchant.Event("load"))},0);return r},enchant.Sound.enabledInMobileSafari=!1;
>>>>>>> 29d121b8fd4aed6431679201e10989f6bd69db5b
